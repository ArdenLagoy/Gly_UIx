{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar _a;\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { ScheduleComponent } from './schedule.component';\nimport { OutputComponent } from './output.component';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nlet SchedulingJobLogsComponent = class SchedulingJobLogsComponent {\n  // Inject MatSnackBar optionally (use type any so build won't fail if package not installed yet)\n  constructor(snackBar) {\n    this.snackBar = snackBar;\n    // Tabs\n    this.activeTab = 'jobs';\n    // Jobs table state\n    this.jobs = [];\n    this.filteredJobs = [];\n    this.paginatedJobs = [];\n    this.search = '';\n    this.statusFilter = '';\n    this.sortField = 'start';\n    this.sortDirection = 'desc';\n    this.pageSize = 10;\n    this.jobPage = 1;\n    this.jobTotalPages = 1;\n    this.jobPagesArray = [];\n    // Export menu control\n    this.exportMenuFor = null;\n    // Toast / busy state\n    this.toastMessage = '';\n    this.busy = false;\n    this.busyMessage = '';\n    this.generateSampleJobs();\n    this.applyFilters();\n  }\n  // With Material menus we don't need a manual document click handler to close menus.\n  activateTab(t) {\n    this.activeTab = t;\n  }\n  generateSampleJobs() {\n    const now = new Date();\n    const statuses = ['Queued', 'Running', 'Success', 'Failed'];\n    for (let i = 1; i <= 23; i++) {\n      const start = new Date(now.getTime() - i * 3600 * 1000);\n      const end = Math.random() > 0.3 ? new Date(start.getTime() + Math.floor(Math.random() * 120) * 60000) : null;\n      const status = statuses[i % statuses.length];\n      const logs = Array.from({\n        length: Math.floor(Math.random() * 10)\n      }, (_, k) => `Log line ${k + 1} for job ${i}`);\n      const results = Math.random() > 0.2 ? [{\n        id: 1,\n        value: 'result'\n      }] : [];\n      this.jobs.push({\n        id: i,\n        name: `Job ${i}`,\n        start,\n        end,\n        status,\n        logs,\n        results\n      });\n    }\n  }\n  applyFilters() {\n    const term = this.search?.toLowerCase().trim();\n    this.filteredJobs = this.jobs.filter(j => {\n      if (this.statusFilter && j.status !== this.statusFilter) return false;\n      if (term && !j.name.toLowerCase().includes(term)) return false;\n      return true;\n    });\n    this.filteredJobs.sort((a, b) => {\n      let av = a[this.mapSortField(this.sortField)];\n      let bv = b[this.mapSortField(this.sortField)];\n      if (av == null) av = '';\n      if (bv == null) bv = '';\n      if (av < bv) return this.sortDirection === 'asc' ? -1 : 1;\n      if (av > bv) return this.sortDirection === 'asc' ? 1 : -1;\n      return 0;\n    });\n    this.jobPage = 1;\n    this.updateJobPagination();\n  }\n  mapSortField(f) {\n    return f === 'name' ? 'name' : f === 'start' ? 'start' : 'end';\n  }\n  sortBy(f) {\n    if (this.sortField === f) this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';else {\n      this.sortField = f;\n      this.sortDirection = 'asc';\n    }\n    this.applyFilters();\n  }\n  updateJobPagination() {\n    this.jobTotalPages = Math.max(1, Math.ceil(this.filteredJobs.length / this.pageSize));\n    this.jobPagesArray = Array.from({\n      length: this.jobTotalPages\n    }, (_, i) => i + 1);\n    this.goToJobPage(Math.min(this.jobPage, this.jobTotalPages));\n  }\n  goToJobPage(p) {\n    this.jobPage = Math.max(1, Math.min(p, this.jobTotalPages));\n    const start = (this.jobPage - 1) * this.pageSize;\n    const end = start + this.pageSize;\n    this.paginatedJobs = this.filteredJobs.slice(start, end);\n  }\n  prevJobPage() {\n    if (this.jobPage > 1) this.goToJobPage(this.jobPage - 1);\n  }\n  nextJobPage() {\n    if (this.jobPage < this.jobTotalPages) this.goToJobPage(this.jobPage + 1);\n  }\n  onPageSizeChange() {\n    this.updateJobPagination();\n  }\n  getJobRangeStart() {\n    return this.filteredJobs.length ? (this.jobPage - 1) * this.pageSize + 1 : 0;\n  }\n  getJobRangeEnd() {\n    return Math.min(this.jobPage * this.pageSize, this.filteredJobs.length);\n  }\n  statusBadgeClass(status) {\n    switch (status) {\n      case 'Queued':\n        return 'bg-slate-100 text-slate-700';\n      case 'Running':\n        return 'bg-blue-100 text-blue-700';\n      case 'Success':\n        return 'bg-emerald-100 text-emerald-700';\n      case 'Failed':\n        return 'bg-rose-100 text-rose-700';\n      default:\n        return 'bg-slate-100 text-slate-700';\n    }\n  }\n  // Export logs (per job) as CSV\n  exportLogs(job) {\n    if (!job.logs || job.logs.length === 0) return;\n    this.busy = true;\n    this.busyMessage = 'Exporting logs...';\n    setTimeout(() => {\n      const csv = job.logs.map((l, i) => `\"${l.replace(/\"/g, '\"\"')}\"`).join('\\r\\n');\n      const blob = new Blob([csv], {\n        type: 'text/csv;charset=utf-8;'\n      });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `job-${job.id}-logs-${new Date().toISOString().replace(/[:.]/g, '-')}.csv`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      this.busy = false;\n      this.busyMessage = '';\n      this.showToast('Logs exported successfully');\n    }, 600);\n  }\n  toggleExportMenu(job) {\n    // kept for compatibility if a non-Material menu is used elsewhere\n    this.exportMenuFor = this.exportMenuFor === job.id ? null : job.id;\n  }\n  // Export report in several formats (client-side stubs)\n  exportReport(job, fmt) {\n    if (!job.results || job.results.length === 0) return;\n    this.exportMenuFor = null;\n    this.busy = true;\n    this.busyMessage = 'Exporting report...';\n    setTimeout(() => {\n      if (fmt === 'json') {\n        const blob = new Blob([JSON.stringify(job.results, null, 2)], {\n          type: 'application/json'\n        });\n        this.triggerDownload(blob, `job-${job.id}-report-${this.tsStamp()}.json`);\n      } else if (fmt === 'csv') {\n        // Simple CSV: flatten result keys\n        const keys = Object.keys(job.results[0] || {});\n        const lines = [keys.join(',')].concat(job.results.map(r => keys.map(k => `\"${String(r[k] || '').replace(/\"/g, '\"\"')}\"`).join(',')));\n        const blob = new Blob([lines.join('\\r\\n')], {\n          type: 'text/csv'\n        });\n        this.triggerDownload(blob, `job-${job.id}-report-${this.tsStamp()}.csv`);\n      } else if (fmt === 'excel') {\n        // For simplicity create a CSV but with .xlsx extension — note: real Excel/XLSX requires a library\n        const keys = Object.keys(job.results[0] || {});\n        const lines = [keys.join(',')].concat(job.results.map(r => keys.map(k => `\"${String(r[k] || '').replace(/\"/g, '\"\"')}\"`).join(',')));\n        const blob = new Blob([lines.join('\\r\\n')], {\n          type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n        });\n        this.triggerDownload(blob, `job-${job.id}-report-${this.tsStamp()}.xlsx`);\n      } else if (fmt === 'xaml') {\n        const xml = `<Results>${job.results.map(r => `<Item>${Object.keys(r).map(k => `<${k}>${String(r[k] || '')}</${k}>`).join('')}</Item>`).join('')}</Results>`;\n        const blob = new Blob([xml], {\n          type: 'application/xml'\n        });\n        this.triggerDownload(blob, `job-${job.id}-report-${this.tsStamp()}.xaml`);\n      }\n      this.busy = false;\n      this.busyMessage = '';\n      // use MatSnackBar if available\n      try {\n        this.snackBar?.open('Report exported successfully', undefined, {\n          duration: 2500\n        });\n      } catch (e) {\n        this.showToast('Report exported successfully');\n      }\n    }, 900);\n  }\n  triggerDownload(blob, filename) {\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  }\n  tsStamp() {\n    return new Date().toISOString().replace(/[:.]/g, '-');\n  }\n  showToast(msg) {\n    this.toastMessage = msg;\n    setTimeout(() => this.toastMessage = '', 2500);\n  }\n};\nSchedulingJobLogsComponent = __decorate([Component({\n  selector: 'scheduling-job-logs',\n  standalone: true,\n  imports: [CommonModule, FormsModule, ScheduleComponent, OutputComponent, MatMenuModule, MatButtonModule, MatIconModule],\n  template: `\n    <section id=\"scheduling-job-logs\" class=\"view\" aria-labelledby=\"sched-title\">\n      <div class=\"flex items-center justify-between mb-4\">\n        <h1 id=\"sched-title\" class=\"text-2xl font-bold\">Scheduling - Job Logs</h1>\n      </div>\n\n      <!-- Sub-tabs -->\n      <div class=\"mb-4\">\n        <nav class=\"flex items-center gap-2 overflow-x-auto\">\n          <button (click)=\"activateTab('jobs')\" [class.font-semibold]=\"activeTab==='jobs'\" [class.border-b-2]=\"activeTab==='jobs'\" class=\"px-3 py-2 rounded-t-md text-slate-700 hover:bg-slate-50\">Jobs</button>\n          <button (click)=\"activateTab('schedule')\" [class.font-semibold]=\"activeTab==='schedule'\" [class.border-b-2]=\"activeTab==='schedule'\" class=\"px-3 py-2 rounded-t-md text-slate-700 hover:bg-slate-50\">Schedule</button>\n          <button (click)=\"activateTab('output')\" [class.font-semibold]=\"activeTab==='output'\" [class.border-b-2]=\"activeTab==='output'\" class=\"px-3 py-2 rounded-t-md text-slate-700 hover:bg-slate-50\">Output</button>\n\n          <!-- responsive collapse to select on very small screens -->\n          <div class=\"ml-auto md:hidden\">\n            <select [(ngModel)]=\"activeTab\" class=\"px-2 py-1 border rounded\">\n              <option value=\"jobs\">Jobs</option>\n              <option value=\"schedule\">Schedule</option>\n              <option value=\"output\">Output</option>\n            </select>\n          </div>\n        </nav>\n      </div>\n\n      <!-- Jobs Tab -->\n      <div *ngIf=\"activeTab==='jobs'\">\n        <div class=\"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-3\">\n          <div class=\"flex items-center gap-2\">\n            <input type=\"text\" placeholder=\"Search jobs\" [(ngModel)]=\"search\" (input)=\"applyFilters()\" class=\"px-3 py-2 border rounded\" />\n            <select [(ngModel)]=\"statusFilter\" (change)=\"applyFilters()\" class=\"px-3 py-2 border rounded\">\n              <option value=\"\">All statuses</option>\n              <option value=\"Queued\">Queued</option>\n              <option value=\"Running\">Running</option>\n              <option value=\"Success\">Success</option>\n              <option value=\"Failed\">Failed</option>\n            </select>\n          </div>\n\n          <div class=\"flex items-center gap-2\">\n            <label class=\"text-sm text-slate-600\">Page size</label>\n            <select [(ngModel)]=\"pageSize\" (change)=\"onPageSizeChange()\" class=\"px-2 py-1 border rounded\">\n              <option [value]=\"5\">5</option>\n              <option [value]=\"10\">10</option>\n              <option [value]=\"20\">20</option>\n            </select>\n          </div>\n        </div>\n\n        <div class=\"overflow-x-auto bg-white rounded-xl border border-slate-200\">\n          <table class=\"w-full text-sm\">\n            <thead class=\"bg-slate-50\">\n              <tr>\n                <th class=\"text-left px-4 py-3 cursor-pointer\" (click)=\"sortBy('name')\">Job Name <span *ngIf=\"sortField==='name'\">{{ sortDirection==='asc' ? '▲' : '▼' }}</span></th>\n                <th class=\"text-left px-4 py-3 cursor-pointer\" (click)=\"sortBy('start')\">Start Date & Time <span *ngIf=\"sortField==='start'\">{{ sortDirection==='asc' ? '▲' : '▼' }}</span></th>\n                <th class=\"text-left px-4 py-3 cursor-pointer\" (click)=\"sortBy('end')\">End Date & Time <span *ngIf=\"sortField==='end'\">{{ sortDirection==='asc' ? '▲' : '▼' }}</span></th>\n                <th class=\"text-left px-4 py-3\">Status</th>\n                <th class=\"text-left px-4 py-3\">Export Logs</th>\n                <th class=\"text-left px-4 py-3\">Export Report</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr *ngFor=\"let j of paginatedJobs\">\n                <td class=\"px-4 py-3\">{{ j.name }}</td>\n                <td class=\"px-4 py-3\">{{ j.start | date:'short' }}</td>\n                <td class=\"px-4 py-3\">{{ j.end ? (j.end | date:'short') : '-' }}</td>\n                <td class=\"px-4 py-3\">\n                  <span [ngClass]=\"statusBadgeClass(j.status)\" class=\"px-2 py-1 rounded-full text-xs font-medium\">{{ j.status }}</span>\n                </td>\n                <td class=\"px-4 py-3\">\n                  <button (click)=\"exportLogs(j)\" [disabled]=\"!j.logs || j.logs.length===0\" class=\"px-2 py-1 border rounded bg-white hover:bg-slate-50\">\n                    CSV\n                  </button>\n                </td>\n                <td class=\"px-4 py-3\">\n                              <div>\n                                <button mat-button [matMenuTriggerFor]=\"menu\" [disabled]=\"!j.results || j.results.length===0\">Export Report ▾</button>\n                                <mat-menu #menu=\"matMenu\">\n                                  <button mat-menu-item (click)=\"exportReport(j,'csv')\" [disabled]=\"!j.results || j.results.length===0\">CSV</button>\n                                  <button mat-menu-item (click)=\"exportReport(j,'excel')\" [disabled]=\"!j.results || j.results.length===0\">Excel</button>\n                                  <button mat-menu-item (click)=\"exportReport(j,'json')\" [disabled]=\"!j.results || j.results.length===0\">JSON</button>\n                                  <button mat-menu-item (click)=\"exportReport(j,'xaml')\" [disabled]=\"!j.results || j.results.length===0\">XAML</button>\n                                </mat-menu>\n                              </div>\n                </td>\n              </tr>\n              <tr *ngIf=\"paginatedJobs.length===0\"><td colspan=\"6\" class=\"px-4 py-6 text-center text-slate-500\">No jobs found.</td></tr>\n            </tbody>\n          </table>\n        </div>\n\n        <!-- Pagination -->\n        <div class=\"flex items-center justify-between mt-3\">\n          <div class=\"text-sm text-slate-600\">Showing {{ getJobRangeStart() }} - {{ getJobRangeEnd() }} of {{ filteredJobs.length }}</div>\n          <div class=\"flex items-center gap-2\">\n            <button (click)=\"prevJobPage()\" [disabled]=\"jobPage===1\" class=\"px-2 py-1 border rounded\">Prev</button>\n            <button *ngFor=\"let p of jobPagesArray\" (click)=\"goToJobPage(p)\" [class.font-bold]=\"p===jobPage\" class=\"px-2 py-1 border rounded\">{{ p }}</button>\n            <button (click)=\"nextJobPage()\" [disabled]=\"jobPage===jobTotalPages\" class=\"px-2 py-1 border rounded\">Next</button>\n          </div>\n        </div>\n      </div>\n\n      <!-- Schedule Tab -->\n      <div *ngIf=\"activeTab==='schedule'\">\n        <schedule-view></schedule-view>\n      </div>\n\n      <!-- Output Tab -->\n      <div *ngIf=\"activeTab==='output'\">\n        <output-view></output-view>\n      </div>\n\n      <!-- Simple toast / spinner area -->\n      <div *ngIf=\"toastMessage\" class=\"fixed bottom-4 right-4 bg-slate-800 text-white px-4 py-2 rounded shadow\">{{ toastMessage }}</div>\n      <div *ngIf=\"busy\" class=\"fixed bottom-4 left-4 bg-white border rounded px-3 py-2 shadow inline-flex items-center gap-2\">\n        <svg class=\"w-4 h-4 animate-spin text-slate-600\" viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"10\" stroke-width=\"3\" stroke=\"currentColor\" fill=\"none\" opacity=\"0.25\"/></svg>\n        <span class=\"text-sm text-slate-700\">{{ busyMessage }}</span>\n      </div>\n    </section>\n  `\n}), __metadata(\"design:paramtypes\", [typeof (_a = typeof MatSnackBar !== \"undefined\" && MatSnackBar) === \"function\" ? _a : Object])], SchedulingJobLogsComponent);\nexport { SchedulingJobLogsComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}