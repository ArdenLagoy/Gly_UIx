{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Ritz/Documents/GitHub/AP-UI/angular-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ElementRef } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as pdfjsLib from 'pdfjs-dist';\nimport * as pdfjsWorker from 'pdfjs-dist/build/pdf.worker.mjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nconst _c0 = [\"pdfCanvas\"];\nconst _c1 = [\"highlightCanvas\"];\n// Configure PDF.js worker\npdfjsLib.GlobalWorkerOptions.workerSrc = URL.createObjectURL(new Blob([pdfjsWorker.WorkerMessageHandler.toString()]));\nexport let ExtractionOverviewComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class ExtractionOverviewComponent {\n    constructor() {\n      // Combined list: each entry = one PDF with its fields\n      this.documents = [{\n        file: 'assets/pdfs/sample1.pdf',\n        fields: {\n          companyName: {\n            value: 'ABC Construction',\n            coords: {\n              x: 120,\n              y: 180,\n              w: 180,\n              h: 20\n            }\n          },\n          invoiceDate: {\n            value: '2024-10-10',\n            coords: {\n              x: 400,\n              y: 120,\n              w: 100,\n              h: 20\n            }\n          },\n          poNumber: {\n            value: 'PO-2394',\n            coords: {\n              x: 400,\n              y: 160,\n              w: 100,\n              h: 20\n            }\n          },\n          amount: {\n            value: '$1,250.00',\n            coords: {\n              x: 400,\n              y: 200,\n              w: 100,\n              h: 20\n            }\n          }\n        }\n      }, {\n        file: 'assets/pdfs/sample2.pdf',\n        fields: {\n          companyName: {\n            value: 'XYZ Builders',\n            coords: {\n              x: 110,\n              y: 200,\n              w: 200,\n              h: 20\n            }\n          },\n          invoiceDate: {\n            value: '2024-11-05',\n            coords: {\n              x: 380,\n              y: 140,\n              w: 100,\n              h: 20\n            }\n          },\n          poNumber: {\n            value: 'PO-4472',\n            coords: {\n              x: 380,\n              y: 180,\n              w: 100,\n              h: 20\n            }\n          },\n          amount: {\n            value: '$3,420.00',\n            coords: {\n              x: 380,\n              y: 220,\n              w: 100,\n              h: 20\n            }\n          }\n        }\n      }, {\n        file: 'assets/pdfs/sample3.pdf',\n        fields: {\n          companyName: {\n            value: 'Global Supplies Inc.',\n            coords: {\n              x: 130,\n              y: 160,\n              w: 180,\n              h: 20\n            }\n          },\n          invoiceDate: {\n            value: '2024-12-01',\n            coords: {\n              x: 420,\n              y: 110,\n              w: 100,\n              h: 20\n            }\n          },\n          poNumber: {\n            value: 'PO-9981',\n            coords: {\n              x: 420,\n              y: 150,\n              w: 100,\n              h: 20\n            }\n          },\n          amount: {\n            value: '$5,000.00',\n            coords: {\n              x: 420,\n              y: 190,\n              w: 100,\n              h: 20\n            }\n          }\n        }\n      }];\n      this.currentIndex = 0;\n    }\n    get currentDoc() {\n      return this.documents[this.currentIndex];\n    }\n    ngAfterViewInit() {\n      this.loadPdf(this.currentDoc.file);\n    }\n    loadPdf(url) {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const loadingTask = pdfjsLib.getDocument(url);\n        _this.pdfDoc = yield loadingTask.promise;\n        const page = yield _this.pdfDoc.getPage(1);\n        const viewport = page.getViewport({\n          scale: 1.5\n        });\n        const canvas = _this.pdfCanvas.nativeElement;\n        const context = canvas.getContext('2d');\n        canvas.height = viewport.height;\n        canvas.width = viewport.width;\n        // Sync highlight canvas size\n        const highlight = _this.highlightCanvas.nativeElement;\n        highlight.width = viewport.width;\n        highlight.height = viewport.height;\n        yield page.render({\n          canvasContext: context,\n          viewport\n        }).promise;\n      })();\n    }\n    nextPdf() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        _this2.currentIndex = (_this2.currentIndex + 1) % _this2.documents.length;\n        yield _this2.loadPdf(_this2.currentDoc.file);\n        _this2.clearHighlight();\n      })();\n    }\n    prevPdf() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        _this3.currentIndex = (_this3.currentIndex - 1 + _this3.documents.length) % _this3.documents.length;\n        yield _this3.loadPdf(_this3.currentDoc.file);\n        _this3.clearHighlight();\n      })();\n    }\n    highlight(fieldKey) {\n      const field = this.currentDoc.fields[fieldKey];\n      const ctx = this.highlightCanvas.nativeElement.getContext('2d');\n      this.clearHighlight();\n      ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';\n      ctx.fillRect(field.coords.x, field.coords.y, field.coords.w, field.coords.h);\n    }\n    clearHighlight() {\n      const ctx = this.highlightCanvas.nativeElement.getContext('2d');\n      ctx.clearRect(0, 0, this.highlightCanvas.nativeElement.width, this.highlightCanvas.nativeElement.height);\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function ExtractionOverviewComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || ExtractionOverviewComponent)();\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ExtractionOverviewComponent,\n      selectors: [[\"extraction-overview\"]],\n      viewQuery: function ExtractionOverviewComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 5);\n          i0.ɵɵviewQuery(_c1, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.pdfCanvas = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.highlightCanvas = _t.first);\n        }\n      },\n      decls: 29,\n      vars: 6,\n      consts: [[\"pdfCanvas\", \"\"], [\"highlightCanvas\", \"\"], [\"id\", \"extraction-overview\", 1, \"view\", \"p-4\", \"grid\", \"grid-cols-3\", \"gap-4\"], [1, \"col-span-2\", \"border\", \"rounded-lg\", \"p-2\", \"relative\"], [1, \"flex\", \"justify-between\", \"mb-2\"], [1, \"bg-gray-200\", \"px-3\", \"py-1\", \"rounded\", 3, \"click\"], [1, \"text-sm\", \"text-gray-600\"], [1, \"border\", \"rounded\"], [1, \"absolute\", \"top-[50px]\", \"left-0\", \"pointer-events-none\"], [1, \"col-span-1\", \"border\", \"rounded-lg\", \"p-4\", \"bg-gray-50\"], [1, \"font-semibold\", \"text-lg\", \"mb-3\"], [1, \"flex\", \"flex-col\", \"gap-2\"], [\"type\", \"text\", 1, \"border\", \"p-1\", \"rounded\", 3, \"ngModelChange\", \"focus\", \"ngModel\"]],\n      template: function ExtractionOverviewComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"section\", 2)(1, \"div\", 3)(2, \"div\", 4)(3, \"button\", 5);\n          i0.ɵɵlistener(\"click\", function ExtractionOverviewComponent_Template_button_click_3_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.prevPdf());\n          });\n          i0.ɵɵtext(4, \"Prev PDF\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"div\", 6);\n          i0.ɵɵtext(6);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"button\", 5);\n          i0.ɵɵlistener(\"click\", function ExtractionOverviewComponent_Template_button_click_7_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.nextPdf());\n          });\n          i0.ɵɵtext(8, \"Next PDF\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(9, \"canvas\", 7, 0)(11, \"canvas\", 8, 1);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(13, \"div\", 9)(14, \"h2\", 10);\n          i0.ɵɵtext(15, \"Detected Fields\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(16, \"div\", 11)(17, \"label\");\n          i0.ɵɵtext(18, \"Company Name:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(19, \"input\", 12);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function ExtractionOverviewComponent_Template_input_ngModelChange_19_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.currentDoc.fields.companyName.value, $event) || (ctx.currentDoc.fields.companyName.value = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵlistener(\"focus\", function ExtractionOverviewComponent_Template_input_focus_19_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.highlight(\"companyName\"));\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(20, \"label\");\n          i0.ɵɵtext(21, \"Invoice Date:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(22, \"input\", 12);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function ExtractionOverviewComponent_Template_input_ngModelChange_22_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.currentDoc.fields.invoiceDate.value, $event) || (ctx.currentDoc.fields.invoiceDate.value = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵlistener(\"focus\", function ExtractionOverviewComponent_Template_input_focus_22_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.highlight(\"invoiceDate\"));\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(23, \"label\");\n          i0.ɵɵtext(24, \"PO Number:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"input\", 12);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function ExtractionOverviewComponent_Template_input_ngModelChange_25_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.currentDoc.fields.poNumber.value, $event) || (ctx.currentDoc.fields.poNumber.value = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵlistener(\"focus\", function ExtractionOverviewComponent_Template_input_focus_25_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.highlight(\"poNumber\"));\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(26, \"label\");\n          i0.ɵɵtext(27, \"Amount:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"input\", 12);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function ExtractionOverviewComponent_Template_input_ngModelChange_28_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.currentDoc.fields.amount.value, $event) || (ctx.currentDoc.fields.amount.value = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵlistener(\"focus\", function ExtractionOverviewComponent_Template_input_focus_28_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.highlight(\"amount\"));\n          });\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(6);\n          i0.ɵɵtextInterpolate2(\"Document \", ctx.currentIndex + 1, \" / \", ctx.documents.length);\n          i0.ɵɵadvance(13);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.currentDoc.fields.companyName.value);\n          i0.ɵɵadvance(3);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.currentDoc.fields.invoiceDate.value);\n          i0.ɵɵadvance(3);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.currentDoc.fields.poNumber.value);\n          i0.ɵɵadvance(3);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.currentDoc.fields.amount.value);\n        }\n      },\n      dependencies: [CommonModule, FormsModule, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgModel],\n      encapsulation: 2\n    }));\n  }\n  _staticBlock();\n  return ExtractionOverviewComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}