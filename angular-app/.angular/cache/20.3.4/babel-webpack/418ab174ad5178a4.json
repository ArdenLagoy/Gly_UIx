{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar _a;\nimport { Component, ViewChild, TemplateRef } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatDialog, MatDialogModule } from '@angular/material/dialog';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { FormsModule } from '@angular/forms';\nlet ScheduleComponent = class ScheduleComponent {\n  constructor(dialog) {\n    this.dialog = dialog;\n    this.schedules = [];\n    this.displayedColumns = ['name', 'frequency', 'nextRun', 'actions'];\n    this.selectedSchedule = null;\n    this.timezones = ['UTC', 'America/New_York', 'Europe/London', 'Asia/Tokyo'];\n    this.daysOfWeek = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];\n    this.daysOfMonth = Array.from({\n      length: 31\n    }, (_, i) => i + 1);\n  }\n  ngOnInit() {\n    // seed with a sample schedule for demo purposes\n    this.schedules.push({\n      id: Date.now(),\n      name: 'Sample Daily',\n      timezone: 'UTC',\n      frequencyType: 'daily',\n      hour: 8,\n      minute: 0,\n      enabled: true\n    });\n  }\n  openAddDialog() {\n    const dialogRef = this.dialog.open(this.dialogTemplate, {\n      data: {\n        name: '',\n        timezone: 'UTC',\n        frequencyType: 'daily',\n        hour: 8,\n        minute: 0,\n        daysOfWeek: {},\n        daysOfMonth: {},\n        monthInterval: 1,\n        cron: '',\n        enabled: true,\n        editing: false\n      },\n      width: '400px',\n      autoFocus: false\n    });\n    dialogRef.afterClosed().subscribe(result => {\n      if (result && !result.editing) {\n        result.id = Date.now();\n        result.enabled = true;\n        // normalize boolean maps\n        result.daysOfWeek = result.daysOfWeek || {};\n        result.daysOfMonth = result.daysOfMonth || {};\n        this.schedules.push(result);\n      }\n    });\n  }\n  openEditDialog(s) {\n    const dialogRef = this.dialog.open(this.dialogTemplate, {\n      data: {\n        ...JSON.parse(JSON.stringify(s)),\n        editing: true\n      },\n      width: '400px',\n      autoFocus: false\n    });\n    dialogRef.afterClosed().subscribe(result => {\n      if (result && result.editing) {\n        // apply edited fields back to the original schedule\n        Object.assign(s, result);\n      }\n    });\n  }\n  saveDialog(data, dialogRef) {\n    // Ensure numeric values\n    if (data.hour != null) data.hour = Number(data.hour);\n    if (data.minute != null) data.minute = Number(data.minute);\n    if (data.monthInterval != null) data.monthInterval = Number(data.monthInterval) || 1;\n    dialogRef.close(data);\n  }\n  toggleEnabled(s) {\n    s.enabled = !s.enabled;\n  }\n  removeSchedule(s) {\n    if (confirm('Remove this schedule?')) {\n      this.schedules = this.schedules.filter(x => x !== s);\n    }\n  }\n  getFrequencySummary(s) {\n    if (s.frequencyType === 'hourly') return `Every hour at minute ${s.minute}`;\n    if (s.frequencyType === 'daily') return `Every day at ${this.pad(s.hour)}:${this.pad(s.minute)}`;\n    if (s.frequencyType === 'weekly') {\n      const days = this.daysOfWeek.filter(d => s.daysOfWeek && s.daysOfWeek[d]).join(', ');\n      return `Weekly on ${days || '(no days selected)'} at ${this.pad(s.hour)}:${this.pad(s.minute)}`;\n    }\n    if (s.frequencyType === 'monthly') {\n      const days = this.daysOfMonth.filter(d => s.daysOfMonth && s.daysOfMonth[d]).join(', ');\n      return `Every ${s.monthInterval || 1} month(s) on days ${days || '(no days selected)'} at ${this.pad(s.hour)}:${this.pad(s.minute)}`;\n    }\n    if (s.frequencyType === 'advanced') return `Cron: ${s.cron}`;\n    return '';\n  }\n  getNextRunText(s) {\n    if (!s.enabled) return 'Disabled';\n    const next = this.computeNextRun(s);\n    if (!next) return '';\n    const now = new Date();\n    const diffMs = next.getTime() - now.getTime();\n    if (diffMs < 60000) return 'in a few seconds';\n    if (diffMs < 3600000) return `in ${Math.round(diffMs / 60000)} min`;\n    if (diffMs < 86400000) return `in ${Math.round(diffMs / 3600000)} hours`;\n    return `in ${Math.round(diffMs / 86400000)} days`;\n  }\n  computeNextRun(s) {\n    const now = new Date();\n    if (!s || !s.frequencyType) return null;\n    if (s.frequencyType === 'hourly') {\n      const next = new Date(now.getTime());\n      next.setMinutes(Number(s.minute) || 0, 0, 0);\n      if (next <= now) next.setHours(next.getHours() + 1);\n      return next;\n    }\n    if (s.frequencyType === 'daily') {\n      const next = new Date(now.getTime());\n      next.setHours(Number(s.hour) || 0, Number(s.minute) || 0, 0, 0);\n      if (next <= now) next.setDate(next.getDate() + 1);\n      return next;\n    }\n    if (s.frequencyType === 'weekly') {\n      // daysOfWeek stored by label (Mon..Sun). Map to JS day index (0=Sun..6=Sat)\n      const checkedIndices = [];\n      for (let i = 0; i < this.daysOfWeek.length; i++) {\n        const label = this.daysOfWeek[i];\n        if (s.daysOfWeek && s.daysOfWeek[label]) {\n          const jsDay = i === 6 ? 0 : i + 1; // Mon->1 ... Sun->0\n          checkedIndices.push(jsDay);\n        }\n      }\n      if (checkedIndices.length === 0) return null;\n      const hour = Number(s.hour) || 0;\n      const minute = Number(s.minute) || 0;\n      const today = now.getDay();\n      let best = null;\n      for (const d of checkedIndices) {\n        let diff = (d - today + 7) % 7;\n        const candidate = new Date(now.getTime());\n        candidate.setDate(now.getDate() + diff);\n        candidate.setHours(hour, minute, 0, 0);\n        if (candidate <= now) {\n          candidate.setDate(candidate.getDate() + 7);\n        }\n        if (!best || candidate < best) best = candidate;\n      }\n      return best;\n    }\n    if (s.frequencyType === 'monthly') {\n      const hour = Number(s.hour) || 0;\n      const minute = Number(s.minute) || 0;\n      const interval = Math.max(1, Number(s.monthInterval) || 1);\n      const checkedDays = s.daysOfMonth ? Object.keys(s.daysOfMonth).map(k => Number(k)).filter(n => !!s.daysOfMonth[n]).sort((a, b) => a - b) : [];\n      if (checkedDays.length === 0) return null;\n      // Try months forward up to 24 months\n      for (let mOff = 0; mOff < 24; mOff++) {\n        const monthCandidate = new Date(now.getFullYear(), now.getMonth() + mOff, 1);\n        if (mOff % interval !== 0) continue;\n        for (const day of checkedDays) {\n          const lastDay = new Date(monthCandidate.getFullYear(), monthCandidate.getMonth() + 1, 0).getDate();\n          const dayVal = Math.min(day, lastDay);\n          const candidate = new Date(monthCandidate.getFullYear(), monthCandidate.getMonth(), dayVal, hour, minute, 0, 0);\n          if (candidate > now) return candidate;\n        }\n      }\n      return null;\n    }\n    if (s.frequencyType === 'advanced') {\n      // Use a global cronParser if the app provides one (e.g. via a script tag).\n      // Do NOT use require() here â€” it's a Node-only API and breaks the browser build.\n      try {\n        const cronParser = window.cronParser || null;\n        if (cronParser && typeof cronParser.parseExpression === 'function') {\n          const interval = cronParser.parseExpression(s.cron || '* * * * *', {\n            currentDate: now\n          });\n          const next = interval.next().toDate();\n          return next;\n        }\n      } catch (e) {\n        // ignore and fallback\n      }\n      // Fallback when no parser is available\n      return new Date(now.getTime() + 3600 * 1000);\n    }\n    return null;\n  }\n  pad(n) {\n    return n.toString().padStart(2, '0');\n  }\n};\n__decorate([ViewChild('dialog', {\n  static: true\n}), __metadata(\"design:type\", TemplateRef)], ScheduleComponent.prototype, \"dialogTemplate\", void 0);\nScheduleComponent = __decorate([Component({\n  selector: 'schedule-view',\n  standalone: true,\n  imports: [CommonModule, FormsModule, MatTableModule, MatDialogModule, MatButtonModule, MatIconModule, MatMenuModule, MatFormFieldModule, MatInputModule, MatSelectModule, MatRadioModule, MatCheckboxModule],\n  template: `\n    <section class=\"p-4\">\n      <div class=\"flex items-center justify-between mb-6\">\n        <h2 class=\"text-2xl font-bold\">Schedules</h2>\n        <button mat-raised-button color=\"primary\" (click)=\"openAddDialog()\">\n          <mat-icon>add</mat-icon> Add New Schedule\n        </button>\n      </div>\n\n      <table mat-table [dataSource]=\"schedules\" class=\"mat-elevation-z1 w-full mb-6\">\n        <ng-container matColumnDef=\"name\">\n          <th mat-header-cell *matHeaderCellDef>Name</th>\n          <td mat-cell *matCellDef=\"let s\">{{s.name}}</td>\n        </ng-container>\n        <ng-container matColumnDef=\"frequency\">\n          <th mat-header-cell *matHeaderCellDef>Frequency</th>\n          <td mat-cell *matCellDef=\"let s\">{{getFrequencySummary(s)}}</td>\n        </ng-container>\n        <ng-container matColumnDef=\"nextRun\">\n          <th mat-header-cell *matHeaderCellDef>Next Run</th>\n          <td mat-cell *matCellDef=\"let s\">{{getNextRunText(s)}}</td>\n        </ng-container>\n        <ng-container matColumnDef=\"actions\">\n          <th mat-header-cell *matHeaderCellDef></th>\n          <td mat-cell *matCellDef=\"let s\">\n            <button mat-icon-button [matMenuTriggerFor]=\"menu\" (click)=\"selectedSchedule=s\">\n              <mat-icon>more_vert</mat-icon>\n            </button>\n            <mat-menu #menu=\"matMenu\">\n              <button mat-menu-item (click)=\"openEditDialog(s)\"><mat-icon>edit</mat-icon> Edit</button>\n              <button mat-menu-item (click)=\"toggleEnabled(s)\"><mat-icon>{{s.enabled ? 'block' : 'check_circle'}}</mat-icon> {{s.enabled ? 'Disable' : 'Enable'}}</button>\n              <button mat-menu-item (click)=\"removeSchedule(s)\"><mat-icon>delete</mat-icon> Remove</button>\n            </mat-menu>\n          </td>\n        </ng-container>\n        <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n        <tr mat-row *matRowDef=\"let row; columns: displayedColumns;\"></tr>\n        <tr *ngIf=\"schedules.length===0\"><td colspan=\"4\" class=\"text-center py-6 text-slate-500\">No schedules found.</td></tr>\n      </table>\n\n      <!-- Add/Edit Dialog -->\n      <ng-template #dialog let-data let-dialogRef=\"dialogRef\">\n        <div class=\"w-full max-w-md p-6\">\n          <h3 class=\"text-xl font-bold mb-4\">{{data.editing ? 'Edit Schedule' : 'Add New Schedule'}}</h3>\n          <form (ngSubmit)=\"saveDialog(data, dialogRef)\">\n            <mat-form-field class=\"w-full mb-3\">\n              <mat-label>Schedule Name</mat-label>\n              <input matInput [(ngModel)]=\"data.name\" name=\"name\" required />\n            </mat-form-field>\n            <mat-form-field class=\"w-full mb-3\">\n              <mat-label>Timezone</mat-label>\n              <mat-select [(ngModel)]=\"data.timezone\" name=\"timezone\" required>\n                <mat-option *ngFor=\"let tz of timezones\" [value]=\"tz\">{{tz}}</mat-option>\n              </mat-select>\n            </mat-form-field>\n            <mat-radio-group [(ngModel)]=\"data.frequencyType\" name=\"frequencyType\" class=\"mb-3 flex flex-col gap-2\">\n              <mat-radio-button value=\"hourly\">Hourly</mat-radio-button>\n              <mat-radio-button value=\"daily\">Daily</mat-radio-button>\n              <mat-radio-button value=\"weekly\">Weekly</mat-radio-button>\n              <mat-radio-button value=\"monthly\">Monthly</mat-radio-button>\n              <mat-radio-button value=\"advanced\">Advanced (Cron Expression)</mat-radio-button>\n            </mat-radio-group>\n\n            <!-- Dynamic fields per frequency type -->\n            <div *ngIf=\"data.frequencyType==='hourly'\">\n              <mat-form-field class=\"w-full mb-3\">\n                <mat-label>Minute</mat-label>\n                <input matInput type=\"number\" min=\"0\" max=\"59\" [(ngModel)]=\"data.minute\" name=\"minute\" required />\n              </mat-form-field>\n            </div>\n            <div *ngIf=\"data.frequencyType==='daily'\">\n              <mat-form-field class=\"w-full mb-3\">\n                <mat-label>Hour</mat-label>\n                <input matInput type=\"number\" min=\"0\" max=\"23\" [(ngModel)]=\"data.hour\" name=\"hour\" required />\n              </mat-form-field>\n              <mat-form-field class=\"w-full mb-3\">\n                <mat-label>Minute</mat-label>\n                <input matInput type=\"number\" min=\"0\" max=\"59\" [(ngModel)]=\"data.minute\" name=\"minute\" required />\n              </mat-form-field>\n            </div>\n            <div *ngIf=\"data.frequencyType==='weekly'\">\n              <div class=\"mb-3\">\n                <label class=\"block mb-1\">Days of week</label>\n                <mat-checkbox *ngFor=\"let d of daysOfWeek\" [(ngModel)]=\"data.daysOfWeek[d]\" name=\"dow_{{d}}\">{{d}}</mat-checkbox>\n              </div>\n              <mat-form-field class=\"w-full mb-3\">\n                <mat-label>Hour</mat-label>\n                <input matInput type=\"number\" min=\"0\" max=\"23\" [(ngModel)]=\"data.hour\" name=\"hour\" required />\n              </mat-form-field>\n              <mat-form-field class=\"w-full mb-3\">\n                <mat-label>Minute</mat-label>\n                <input matInput type=\"number\" min=\"0\" max=\"59\" [(ngModel)]=\"data.minute\" name=\"minute\" required />\n              </mat-form-field>\n            </div>\n            <div *ngIf=\"data.frequencyType==='monthly'\">\n              <mat-form-field class=\"w-full mb-3\">\n                <mat-label>Every X months</mat-label>\n                <input matInput type=\"number\" min=\"1\" max=\"12\" [(ngModel)]=\"data.monthInterval\" name=\"monthInterval\" required />\n              </mat-form-field>\n              <div class=\"mb-3\">\n                <label class=\"block mb-1\">Days of month</label>\n                <mat-checkbox *ngFor=\"let d of daysOfMonth\" [(ngModel)]=\"data.daysOfMonth[d]\" name=\"dom_{{d}}\">{{d}}</mat-checkbox>\n              </div>\n              <mat-form-field class=\"w-full mb-3\">\n                <mat-label>Hour</mat-label>\n                <input matInput type=\"number\" min=\"0\" max=\"23\" [(ngModel)]=\"data.hour\" name=\"hour\" required />\n              </mat-form-field>\n              <mat-form-field class=\"w-full mb-3\">\n                <mat-label>Minute</mat-label>\n                <input matInput type=\"number\" min=\"0\" max=\"59\" [(ngModel)]=\"data.minute\" name=\"minute\" required />\n              </mat-form-field>\n            </div>\n            <div *ngIf=\"data.frequencyType==='advanced'\">\n              <mat-form-field class=\"w-full mb-3\">\n                <mat-label>Cron Expression</mat-label>\n                <input matInput [(ngModel)]=\"data.cron\" name=\"cron\" required />\n              </mat-form-field>\n            </div>\n\n            <div class=\"flex gap-3 justify-end mt-6\">\n              <button mat-stroked-button type=\"button\" (click)=\"dialogRef.close()\">Cancel</button>\n              <button mat-raised-button color=\"primary\" type=\"submit\">{{data.editing ? 'Update' : 'Add'}}</button>\n            </div>\n          </form>\n        </div>\n      </ng-template>\n    </section>\n  `\n}), __metadata(\"design:paramtypes\", [typeof (_a = typeof MatDialog !== \"undefined\" && MatDialog) === \"function\" ? _a : Object])], ScheduleComponent);\nexport { ScheduleComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}