{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Ritz/Documents/GitHub/Gly_UIx/angular-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ElementRef } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as pdfjsLib from 'pdfjs-dist';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/forms\";\nconst _c0 = [\"pdfCanvas\"];\nconst _c1 = [\"highlightCanvas\"];\nconst _c2 = [\"pdfWrapper\"];\nconst _c3 = [\"pdfScroll\"];\nconst _c4 = a0 => ({\n  \"background-color\": a0\n});\nfunction ClassificationOverviewComponent_ng_container_7_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function ClassificationOverviewComponent_ng_container_7_div_18_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.submitClassification());\n    });\n    i0.ɵɵtext(2, \" Submit \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", !ctx_r1.currentDoc || ctx_r1.noDocsToValidate);\n  }\n}\nfunction ClassificationOverviewComponent_ng_container_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 12)(2, \"div\", 13)(3, \"div\")(4, \"label\", 14);\n    i0.ɵɵtext(5, \"Project Type\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"select\", 15);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ClassificationOverviewComponent_ng_container_7_Template_select_ngModelChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.currentDoc.project, $event) || (ctx_r1.currentDoc.project = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementStart(7, \"option\");\n    i0.ɵɵtext(8, \"Invoice Processing\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"option\");\n    i0.ɵɵtext(10, \"Payments & Disbursements\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"option\");\n    i0.ɵɵtext(12, \"Vendor Management\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(13, \"div\", 16)(14, \"span\", 17);\n    i0.ɵɵtext(15, \"Confidence\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"span\", 18);\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(18, ClassificationOverviewComponent_ng_container_7_div_18_Template, 3, 1, \"div\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 20)(20, \"div\", 21)(21, \"div\", 22)(22, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function ClassificationOverviewComponent_ng_container_7_Template_button_click_22_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.previousPage());\n    });\n    i0.ɵɵtext(23, \"\\u2190\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"span\", 24);\n    i0.ɵɵtext(25);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function ClassificationOverviewComponent_ng_container_7_Template_button_click_26_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.nextPage());\n    });\n    i0.ɵɵtext(27, \"\\u2192\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(28, \"div\", 22)(29, \"button\", 25);\n    i0.ɵɵlistener(\"click\", function ClassificationOverviewComponent_ng_container_7_Template_button_click_29_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.zoomOut());\n    });\n    i0.ɵɵtext(30, \"\\u2212\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(31, \"span\", 26);\n    i0.ɵɵtext(32);\n    i0.ɵɵpipe(33, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"button\", 25);\n    i0.ɵɵlistener(\"click\", function ClassificationOverviewComponent_ng_container_7_Template_button_click_34_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.zoomIn());\n    });\n    i0.ɵɵtext(35, \"+\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(36, \"div\", 27, 1)(38, \"div\", 28, 2);\n    i0.ɵɵelement(40, \"canvas\", 29, 3)(42, \"canvas\", 30, 4);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.currentDoc.project);\n    i0.ɵɵadvance(10);\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction1(12, _c4, ctx_r1.getConfidenceColor(ctx_r1.currentDoc.confidence)));\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.currentDoc.confidence, \"% \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", (ctx_r1.currentDoc == null ? null : ctx_r1.currentDoc.validationStatus) !== \"Complete\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.currentPage <= 1);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\"Page \", ctx_r1.currentPage, \" / \", ctx_r1.totalPages);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r1.currentPage >= ctx_r1.totalPages);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(33, 9, ctx_r1.zoomLevel * 100, \"1.0-0\"), \"%\");\n  }\n}\nfunction ClassificationOverviewComponent_ng_template_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 32);\n    i0.ɵɵtext(1, \" No documents to validate \");\n    i0.ɵɵelementEnd();\n  }\n}\npdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjsLib.version}/pdf.worker.min.js`;\nexport let ClassificationOverviewComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class ClassificationOverviewComponent {\n    constructor() {\n      this.searchQuery = '';\n      this.selectedStatus = '';\n      this.statuses = ['Needs Validation', 'Complete'];\n      this.zoomLevel = 1.5;\n      this.baseScale = 1;\n      this.baseWidth = 550;\n      this.currentIndex = 0;\n      this.noDocsToValidate = false;\n      this.currentPage = 1;\n      this.totalPages = 1;\n      this.documents = [{\n        project: 'Invoice Processing',\n        validationStatus: 'Needs Validation',\n        confidence: 93,\n        file: 'assets/pdfs/POT182209.pdf'\n      }, {\n        project: 'Payments & Disbursements',\n        validationStatus: 'Needs Validation',\n        confidence: 81,\n        file: 'assets/pdfs/PO1299488.pdf'\n      }, {\n        project: 'Vendor Management',\n        validationStatus: 'Complete',\n        confidence: 99,\n        file: 'assets/pdfs/PO110000.pdf'\n      }];\n    }\n    get filteredDocuments() {\n      const q = this.searchQuery.trim().toLowerCase();\n      return this.documents.filter(doc => {\n        const matchesSearch = this.getFileName(doc.file).toLowerCase().includes(q);\n        const matchesStatus = this.selectedStatus ? doc.validationStatus === this.selectedStatus : true;\n        return matchesSearch && matchesStatus;\n      });\n    }\n    get currentDoc() {\n      // return null if there are no filtered documents or index out of range\n      return this.filteredDocuments.length === 0 ? null : this.filteredDocuments[this.currentIndex] || null;\n    }\n    ngAfterViewInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (_this.currentDoc) {\n          yield _this.loadPdf(_this.currentDoc.file);\n        }\n      })();\n    }\n    selectPdf(index) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        _this2.currentIndex = index;\n        _this2.zoomLevel = 1.5;\n        yield _this2.loadPdf(_this2.currentDoc.file);\n      })();\n    }\n    loadPdf(url) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const loadingTask = pdfjsLib.getDocument(url);\n        _this3.pdfDoc = yield loadingTask.promise;\n        _this3.totalPages = _this3.pdfDoc.numPages || 1;\n        _this3.currentPage = 1;\n        const page = yield _this3.pdfDoc.getPage(1);\n        const unscaledViewport = page.getViewport({\n          scale: 1\n        });\n        _this3.baseScale = _this3.baseWidth / unscaledViewport.width;\n        yield _this3.renderPage();\n      })();\n    }\n    renderPage() {\n      var _this4 = this;\n      return _asyncToGenerator(function* (pageNum = 1) {\n        if (!_this4.pdfDoc) return;\n        const page = yield _this4.pdfDoc.getPage(pageNum);\n        const viewport = page.getViewport({\n          scale: _this4.baseScale\n        });\n        const canvas = _this4.pdfCanvas.nativeElement;\n        const ctx = canvas.getContext('2d');\n        canvas.height = viewport.height;\n        canvas.width = viewport.width;\n        const highlight = _this4.highlightCanvas.nativeElement;\n        highlight.width = viewport.width;\n        highlight.height = viewport.height;\n        yield page.render({\n          canvasContext: ctx,\n          viewport\n        }).promise;\n        _this4.applyZoomTransform();\n      }).apply(this, arguments);\n    }\n    nextPage() {\n      if (this.currentPage < this.totalPages) {\n        this.currentPage++;\n        this.renderPage(this.currentPage);\n      }\n    }\n    previousPage() {\n      if (this.currentPage > 1) {\n        this.currentPage--;\n        this.renderPage(this.currentPage);\n      }\n    }\n    applyZoomTransform() {\n      if (this.pdfWrapper?.nativeElement && this.pdfScroll?.nativeElement) {\n        const wrapper = this.pdfWrapper.nativeElement;\n        const scroller = this.pdfScroll.nativeElement;\n        // Get current scroll position and viewport dimensions\n        const scrollLeft = scroller.scrollLeft;\n        const scrollerWidth = scroller.clientWidth;\n        // Calculate the center point horizontally (before zoom)\n        const centerX = (scrollLeft + scrollerWidth / 2) / this.zoomLevel;\n        // Apply the zoom transformation\n        wrapper.style.transform = `scale(${this.zoomLevel})`;\n        // Calculate new scroll position to maintain horizontal center\n        // With transform-origin: top center, we only need to adjust horizontally\n        const newScrollLeft = Math.max(0, centerX * this.zoomLevel - scrollerWidth / 2);\n        // Apply the new horizontal scroll position (keep vertical as-is)\n        scroller.scrollLeft = newScrollLeft;\n      }\n    }\n    zoomIn() {\n      const oldZoomLevel = this.zoomLevel;\n      this.zoomLevel = Math.min(this.zoomLevel + 0.1, 3);\n      // Only apply transform if zoom level actually changed\n      if (this.zoomLevel !== oldZoomLevel) {\n        this.applyZoomTransform();\n      }\n    }\n    zoomOut() {\n      const oldZoomLevel = this.zoomLevel;\n      this.zoomLevel = Math.max(this.zoomLevel - 0.1, 0.5);\n      // Only apply transform if zoom level actually changed\n      if (this.zoomLevel !== oldZoomLevel) {\n        this.applyZoomTransform();\n      }\n    }\n    submitClassification() {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this5.currentDoc) return;\n        // Mark runtime-only\n        _this5.currentDoc.validationStatus = 'Complete';\n        // Find next document that still needs validation\n        const next = _this5.documents.find(d => d.validationStatus === 'Needs Validation');\n        if (next) {\n          // set currentIndex to the index of that document in the full documents array\n          _this5.currentIndex = _this5.documents.indexOf(next);\n          _this5.noDocsToValidate = false;\n          _this5.zoomLevel = 1.5;\n          yield _this5.loadPdf(_this5.currentDoc.file);\n        } else {\n          // no documents left\n          _this5.currentIndex = -1;\n          _this5.noDocsToValidate = true;\n          _this5.pdfDoc = null;\n          // clear canvases if present\n          try {\n            const canvas = _this5.pdfCanvas?.nativeElement;\n            if (canvas) {\n              const ctx = canvas.getContext('2d');\n              if (ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);\n              canvas.width = 0;\n              canvas.height = 0;\n            }\n            const h = _this5.highlightCanvas?.nativeElement;\n            if (h) {\n              const hctx = h.getContext('2d');\n              if (hctx) hctx.clearRect(0, 0, h.width, h.height);\n              h.width = 0;\n              h.height = 0;\n            }\n          } catch (e) {\n            // ignore canvas clear errors\n            console.warn('Error clearing canvases', e);\n          }\n        }\n      })();\n    }\n    getConfidenceColor(conf) {\n      if (conf >= 95) return '#22c55e'; // green\n      if (conf >= 80) return '#eab308'; // yellow\n      return '#ef4444'; // red\n    }\n    getFileName(path) {\n      return path.split('/').pop() || '';\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function ClassificationOverviewComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || ClassificationOverviewComponent)();\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ClassificationOverviewComponent,\n      selectors: [[\"classification-overview\"]],\n      viewQuery: function ClassificationOverviewComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 5);\n          i0.ɵɵviewQuery(_c1, 5);\n          i0.ɵɵviewQuery(_c2, 5);\n          i0.ɵɵviewQuery(_c3, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.pdfCanvas = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.highlightCanvas = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.pdfWrapper = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.pdfScroll = _t.first);\n        }\n      },\n      decls: 10,\n      vars: 2,\n      consts: [[\"noDocsTemplate\", \"\"], [\"pdfScroll\", \"\"], [\"pdfWrapper\", \"\"], [\"pdfCanvas\", \"\"], [\"highlightCanvas\", \"\"], [\"id\", \"classification-overview\", \"aria-labelledby\", \"classov-title\", 1, \"view\", \"active\"], [1, \"flex\", \"items-center\", \"justify-between\", \"mb-4\"], [\"id\", \"classov-title\", 1, \"text-2xl\", \"font-bold\"], [1, \"flex\", \"items-center\", \"gap-3\"], [1, \"rounded-2xl\", \"bg-white\", \"p-5\", \"shadow-sm\", \"border\", \"border-slate-200\", \"flex\", \"gap-5\", \"overflow-hidden\", \"w-full\", \"box-border\"], [1, \"flex-1\", \"min-w-0\", \"flex\", \"flex-col\", \"gap-4\"], [4, \"ngIf\", \"ngIfElse\"], [1, \"flex\", \"justify-between\", \"items-center\", \"border\", \"border-slate-200\", \"bg-slate-50\", \"rounded-xl\", \"p-3\"], [1, \"flex\", \"items-center\", \"gap-5\"], [1, \"text-sm\", \"text-slate-600\", \"font-semibold\", \"block\", \"mb-1\"], [1, \"px-3\", \"py-2\", \"rounded-xl\", \"border\", \"border-slate-300\", \"text-sm\", \"bg-white\", 3, \"ngModelChange\", \"ngModel\"], [1, \"flex\", \"flex-col\"], [1, \"text-sm\", \"text-slate-600\", \"font-semibold\", \"mb-1\"], [1, \"px-3\", \"py-1\", \"rounded-lg\", \"text-white\", \"text-sm\", \"font-medium\", \"w-fit\", \"shadow-sm\", 3, \"ngStyle\"], [4, \"ngIf\"], [1, \"flex-1\", \"relative\", \"rounded-xl\", \"border\", \"border-slate-200\", \"bg-slate-50\", \"flex\", \"flex-col\", \"overflow-hidden\"], [1, \"flex\", \"justify-between\", \"items-center\", \"gap-2\", \"p-2\", \"bg-slate-100\", \"border-b\", \"border-slate-200\", \"rounded-t-xl\"], [1, \"flex\", \"items-center\", \"gap-2\"], [1, \"px-3\", \"py-1\", \"rounded-md\", \"border\", \"border-slate-300\", \"bg-white\", \"hover:bg-slate-200\", \"text-sm\", \"disabled:opacity-50\", \"disabled:cursor-not-allowed\", 3, \"click\", \"disabled\"], [1, \"text-sm\", \"font-medium\", \"text-slate-600\", \"min-w-[80px]\", \"text-center\"], [1, \"px-3\", \"py-1\", \"rounded-md\", \"border\", \"border-slate-300\", \"bg-white\", \"hover:bg-slate-200\", \"text-sm\", 3, \"click\"], [1, \"text-sm\", \"font-medium\", \"text-slate-600\", \"w-14\", \"text-center\"], [1, \"relative\", \"flex\", \"justify-center\", \"items-start\", \"p-2\", \"overflow-auto\", \"flex-1\", \"bg-slate-50\"], [1, \"inline-block\", 2, \"position\", \"relative\", \"transition\", \"transform 0.2s ease\", \"transform-origin\", \"top center\"], [1, \"border\", \"rounded\", \"shadow-sm\", \"block\"], [1, \"absolute\", \"top-0\", \"left-0\", \"pointer-events-none\"], [1, \"px-4\", \"py-2\", \"rounded-xl\", \"bg-indigo-600\", \"hover:bg-indigo-700\", \"text-white\", \"text-sm\", \"font-medium\", \"transition\", \"disabled:opacity-50\", \"disabled:cursor-not-allowed\", 3, \"click\", \"disabled\"], [1, \"flex-1\", \"rounded-xl\", \"border\", \"border-slate-200\", \"bg-slate-50\", \"flex\", \"items-center\", \"justify-center\", \"p-6\", \"text-slate-500\"]],\n      template: function ClassificationOverviewComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"section\", 5)(1, \"div\", 6)(2, \"h1\", 7);\n          i0.ɵɵtext(3, \"Classification Overview\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(4, \"div\", 8);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"section\", 9)(6, \"div\", 10);\n          i0.ɵɵtemplate(7, ClassificationOverviewComponent_ng_container_7_Template, 44, 14, \"ng-container\", 11)(8, ClassificationOverviewComponent_ng_template_8_Template, 2, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          const noDocsTemplate_r4 = i0.ɵɵreference(9);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngIf\", ctx.currentDoc)(\"ngIfElse\", noDocsTemplate_r4);\n        }\n      },\n      dependencies: [CommonModule, i1.NgIf, i1.NgStyle, FormsModule, i2.NgSelectOption, i2.ɵNgSelectMultipleOption, i2.SelectControlValueAccessor, i2.NgControlStatus, i2.NgModel, i1.DecimalPipe],\n      encapsulation: 2\n    }));\n  }\n  _staticBlock();\n  return ClassificationOverviewComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}